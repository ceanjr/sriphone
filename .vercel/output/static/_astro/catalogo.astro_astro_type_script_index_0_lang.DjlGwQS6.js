import{a as o,p as e,c as a}from"./supabase.Cm9Ta47n.js";const t={produtos:[],categorias:[],categoriaAtiva:"todos",modoVisualizacao:window.innerWidth<768?"coluna":"grade",filtros:{busca:"",condicao:"",bateria:0,ordenacao:"recente"},paginacao:{itensPorPagina:30,paginaAtual:1,totalPaginas:1,carregando:!1,hasMore:!0}},r={modalLogin:document.getElementById("modal-login"),formLogin:document.getElementById("form-login"),loginError:document.getElementById("login-error"),searchInput:document.getElementById("search-input"),toggleFiltros:document.getElementById("toggle-filtros"),filtrosAvancados:document.getElementById("filtros-avancados"),btnLimparFiltros:document.getElementById("btn-limpar-filtros"),produtosContainer:document.getElementById("produtos-container"),loading:document.getElementById("loading"),loadingMore:document.getElementById("loading-more"),scrollSentinel:document.getElementById("scroll-sentinel"),emptyState:document.getElementById("empty-state"),categoriasLista:document.getElementById("categorias-lista"),filtroCondicao:document.getElementById("filtro-condicao"),filtroBateria:document.getElementById("filtro-bateria"),filtroOrdenacao:document.getElementById("filtro-ordenacao"),categoriaSelect:document.getElementById("categoria-select"),visualizacaoContainer:document.querySelector(".visualizacao-container"),visualizacaoBtns:document.querySelectorAll(".visualizacao-btn")};function i(o){const e={todos:0,"iphone 4":1,"iphone 4s":2,"iphone 5":3,"iphone 5c":4,"iphone 5s":5,"iphone 6":6,"iphone 6 plus":7,"iphone 6s":8,"iphone 6s plus":9,"iphone 7":10,"iphone 7 plus":11,"iphone 8":12,"iphone 8 plus":13,"iphone x":14,"iphone xr":15,"iphone xs":16,"iphone xs max":17,"iphone 11":18,"iphone 11 pro":19,"iphone 11 pro max":20,"iphone se":21,"iphone se 2":22,"iphone se 3":23,"iphone 12":24,"iphone 12 mini":25,"iphone 12 pro":26,"iphone 12 pro max":27,"iphone 13":28,"iphone 13 mini":29,"iphone 13 pro":30,"iphone 13 pro max":31,"iphone 14":32,"iphone 14 plus":33,"iphone 14 pro":34,"iphone 14 pro max":35,"iphone 15":36,"iphone 15 plus":37,"iphone 15 pro":38,"iphone 15 pro max":39,"iphone 16":40,"iphone 16 plus":41,"iphone 16 pro":42,"iphone 16 pro max":43,"iphone 17":44,"iphone 17 air":45,"iphone 17 pro":46,"iphone 17 pro max":47};return[...o].sort((o,a)=>{const t=o.nome.toLowerCase().trim(),r=a.nome.toLowerCase().trim(),i=e[t],n=e[r];return void 0!==i&&void 0!==n?i-n:void 0!==i?-1:void 0!==n?1:t.localeCompare(r,"pt-BR")})}const n={formatarPreco:o=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),calcularLarguraBateria:o=>o/100*14,escapeHtml(o){const e=document.createElement("div");return e.textContent=o,e.innerHTML}};const s={produtoCard(o){const e=n.formatarPreco(o.preco),a=n.calcularLarguraBateria(o.bateria),r=o.bateria>=80?"bateria-verde":"bateria-vermelho";const i=o.imagens?.[0],s=o.bateria&&o.bateria>0,c=JSON.stringify({id:o.id,codigo:o.codigo,nome:o.nome,descricao:o.descricao,preco:e,condicao:o.condicao,bateria:o.bateria,categoria:o.categoria?.nome||"",imagens:o.imagens||[]}).replace(/"/g,"&quot;"),d=JSON.stringify({id:o.id,codigo:o.codigo,nome:o.nome,descricao:o.descricao,preco:o.preco,condicao:o.condicao,bateria:o.bateria,categoria_id:o.categoria_id,imagens:o.imagens||[]}).replace(/"/g,"&quot;"),l=`\n      ${s?"":`<span class="condicao-badge ${o.condicao.toLowerCase()}">${o.condicao}</span>`}\n      ${s?`\n      <div class="bateria-indicator ${r}">\n          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="bateria-icon">\n              <rect x="2" y="7" width="18" height="10" rx="2" stroke="currentColor" stroke-width="2"/>\n              <path d="M20 10H22V14H20" stroke="currentColor" stroke-width="2"/>\n              <rect x="4" y="9" width="${a}" height="6" rx="1" fill="currentColor" class="bateria-fill"/>\n          </svg>\n          <span>${o.bateria}%</span>\n      </div>\n      `:""}\n    `;return"lista"===t.modoVisualizacao?`\n<article class="produto-card" data-produto-id="${o.id}" data-produto="${c}">\n    <button class="btn-editar-produto" data-produto-edit="${d}" aria-label="Editar produto">\n        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n    </button>\n    <div class="produto-info">\n        <div class="lista-left">\n            <h3>${n.escapeHtml(o.nome)}</h3>\n            <p class="descricao">${n.escapeHtml(o.descricao)}</p>\n            <span class="modal-codigo">${o.codigo?`Cod.: ${n.escapeHtml(o.codigo)}`:""}</span>\n        </div>\n        <div class="lista-right">\n            <div class="lista-badges">\n                ${l}\n            </div>\n            <div class="produto-footer">\n                <span class="preco">${e}</span>\n            </div>\n        </div>\n    </div>\n</article>\n`:`\n<article class="produto-card" data-produto-id="${o.id}" data-produto="${c}">\n    <button class="btn-editar-produto" data-produto-edit="${d}" aria-label="Editar produto">\n        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n    </button>\n    <div class="produto-image">\n        ${i?`<img src="${i}" alt="${n.escapeHtml(o.nome)}" loading="lazy" decoding="async" />`:'\n            <div class="image-placeholder">\n                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M21 16V8C21 6.89543 20.1046 6 19 6H5C3.89543 6 3 6.89543 3 8V16C3 17.1046 3.89543 18 5 18H19C20.1046 18 21 17.1046 21 16Z" stroke="currentColor" stroke-width="2"/>\n                    <path d="M9 12L12 9L15 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n                </svg>\n            </div>\n        '}\n        ${l}\n    </div>\n    <div class="produto-info">\n        <h3>${n.escapeHtml(o.nome)}</h3>\n        <p class="descricao">${n.escapeHtml(o.descricao)}</p>\n        <div class="produto-footer">\n            <span class="preco">${e}</span>\n            <button class="btn-detalhes">Ver detalhes</button>\n        </div>\n    </div>\n</article>\n`},categoriaSecao:(o,e)=>`\n      <div class="categoria-section">\n          <h2 class="categoria-titulo">${n.escapeHtml(o)}</h2>\n          <div class="categoria-grid ${t.modoVisualizacao}">\n              ${e.map(o=>s.produtoCard(o)).join("")}\n          </div>\n      </div>\n    `},c={filtrarProdutos:()=>t.produtos.filter(o=>{if("todos"!==t.categoriaAtiva&&o.categoria_id!==t.categoriaAtiva)return!1;if(t.filtros.busca){const e=t.filtros.busca.toLowerCase();if(!(o.nome.toLowerCase().includes(e)||o.descricao.toLowerCase().includes(e)||o.codigo.toLowerCase().includes(e)||o.categoria?.nome.toLowerCase().includes(e)))return!1}return(!t.filtros.condicao||o.condicao===t.filtros.condicao)&&!(o.bateria<t.filtros.bateria)}),ordenarProdutos(o){const e=[...o];switch(t.filtros.ordenacao){case"preco-asc":return e.sort((o,e)=>o.preco-e.preco);case"preco-desc":return e.sort((o,e)=>e.preco-o.preco);case"bateria":return e.sort((o,e)=>e.bateria-o.bateria);default:return e.sort((o,e)=>new Date(e.created_at).getTime()-new Date(o.created_at).getTime())}},agruparPorCategoria(o){const e=new Map;return o.forEach(o=>{const a=o.categoria?.nome||"Sem Categoria";e.has(a)||e.set(a,[]),e.get(a).push(o)}),e}},d={categorias(){if(!r.categoriaSelect)return;const o=i(t.categorias);r.categoriaSelect.innerHTML=`\n    <option value="todos">Todos</option>\n    ${o.map(o=>`\n        <option value="${o.id}">${n.escapeHtml(o.nome)}</option>\n      `).join("")}\n  `,r.categoriasLista&&(r.categoriasLista.innerHTML=o.map(o=>`\n        <button class="categoria-btn" data-categoria="${o.id}">\n            ${n.escapeHtml(o.nome)}\n        </button>\n      `).join("")),r.categoriaSelect.value=t.categoriaAtiva,document.querySelectorAll(".categoria-btn").forEach(o=>{o.classList.toggle("active",o.dataset.categoria===t.categoriaAtiva)}),document.querySelectorAll(".categoria-btn").forEach(o=>{o.addEventListener("click",l.categoriaClick)}),r.categoriaSelect.addEventListener("change",l.categoriaSelectChange),r.visualizacaoBtns.forEach(o=>{o.classList.toggle("active",o.dataset.view===t.modoVisualizacao)})},produtos(){if(!r.produtosContainer||!r.emptyState)return;r.produtosContainer.classList.remove("coluna","grade","lista"),r.produtosContainer.classList.add(t.modoVisualizacao),document.querySelectorAll(".categoria-grid").forEach(o=>{o.classList.remove("coluna","grade","lista"),o.classList.add(t.modoVisualizacao)});let o=c.filtrarProdutos();if(o=c.ordenarProdutos(o),0===o.length)return r.produtosContainer.innerHTML="",void(r.emptyState.style.display="block");if(r.emptyState.style.display="none","todos"===t.categoriaAtiva){const e=c.agruparPorCategoria(o),a=i(Array.from(e.keys()).map(o=>{const e=t.categorias.find(e=>e.nome===o);return{nome:o,categoria:e||{id:"",nome:o,created_at:""}}}).map(o=>o.categoria));r.produtosContainer.innerHTML=a.map(o=>{const a=e.get(o.nome);return a?s.categoriaSecao(o.nome,a):""}).filter(o=>""!==o).join("")}else r.produtosContainer.innerHTML=o.map(o=>s.produtoCard(o)).join("");r.produtosContainer.querySelectorAll(".produto-card").forEach(o=>{o.addEventListener("click",l.produtoClick)}),p()},loading(o){r.loading&&(r.loading.style.display=o?"flex":"none")}},l={categoriaClick(o){const e=o.currentTarget,a=e.dataset.categoria;document.querySelectorAll(".categoria-btn").forEach(o=>o.classList.remove("active")),e.classList.add("active"),t.categoriaAtiva=a||"todos",r.categoriaSelect&&(r.categoriaSelect.value=t.categoriaAtiva),d.produtos()},categoriaSelectChange(o){const e=o.target;t.categoriaAtiva=e.value,document.querySelectorAll(".categoria-btn").forEach(o=>{o.classList.toggle("active",o.dataset.categoria===t.categoriaAtiva)}),d.produtos()},produtoClick(o){const e=o.currentTarget.dataset.produto;if(e)try{const o=JSON.parse(e);window.abrirModalProduto(o)}catch(a){}},searchInput(o){const e=o.target;t.filtros.busca=e.value,d.produtos()},toggleFiltros(){r.filtrosAvancados?.classList.toggle("active")},filtroCondicao(o){const e=o.target;t.filtros.condicao=e.value,d.produtos()},filtroBateria(o){const e=o.target;t.filtros.bateria=parseInt(e.value),d.produtos()},filtroOrdenacao(o){const e=o.target;t.filtros.ordenacao=e.value,d.produtos()},limparFiltros(){t.filtros={busca:"",condicao:"",bateria:0,ordenacao:"recente"},t.categoriaAtiva="todos",r.searchInput&&(r.searchInput.value=""),r.filtroCondicao&&(r.filtroCondicao.selectedIndex=0),r.filtroBateria&&(r.filtroBateria.selectedIndex=0),r.filtroOrdenacao&&(r.filtroOrdenacao.selectedIndex=0),r.categoriaSelect&&(r.categoriaSelect.value="todos"),document.querySelectorAll(".categoria-btn").forEach(o=>{o.classList.toggle("active","todos"===o.dataset.categoria)}),d.produtos()},visualizacaoClick(o){const e=o.currentTarget.dataset.view;t.modoVisualizacao=e,localStorage.setItem("modoVisualizacao",e),r.visualizacaoBtns.forEach(o=>{o.classList.toggle("active",o.dataset.view===e)}),r.produtosContainer?.classList.remove("coluna","grade","lista"),r.produtosContainer?.classList.add(e),document.querySelectorAll(".categoria-grid").forEach(o=>{o.classList.remove("coluna","grade","lista"),o.classList.add(e)}),d.produtos()},async loginSubmit(e){e.preventDefault();const a=document.getElementById("login-email"),t=document.getElementById("login-password");try{await o.signIn(a.value,t.value),r.modalLogin?.classList.remove("active"),r.formLogin?.reset(),r.loginError&&(r.loginError.textContent="",r.loginError.classList.remove("show"))}catch(i){r.loginError&&(r.loginError.textContent=i.message||"Credenciais inválidas",r.loginError.classList.add("show"))}},closeModalLogin(){r.modalLogin?.classList.remove("active")}},g={async carregarDados(){try{d.loading(!0),r.emptyState&&(r.emptyState.style.display="none"),r.produtosContainer&&(r.produtosContainer.innerHTML="");const o="sriphone-produtos-cache",i="sriphone-produtos-cache-time",n=6e5,s=sessionStorage.getItem(o),c=sessionStorage.getItem(i);if(s&&c){if(Date.now()-parseInt(c)<n){const{produtos:o,categorias:e}=JSON.parse(s);return t.produtos=o,t.categorias=e,setTimeout(()=>{o.slice(0,6).map(o=>o.imagens?.[0]).filter(Boolean).forEach((o,e)=>{setTimeout(()=>{(new Image).src=o},100*e)})},500),d.categorias(),d.produtos(),void d.loading(!1)}}const[l,g]=await Promise.all([e.getAll(),a.getAll()]);t.produtos=l,t.categorias=g,sessionStorage.setItem(o,JSON.stringify({produtos:l,categorias:g})),sessionStorage.setItem(i,Date.now().toString()),d.categorias(),d.produtos()}catch(o){alert("Erro ao carregar produtos. Tente novamente.")}finally{d.loading(!1),t.paginacao.carregando=!1}},async carregarMaisProdutos(){if(!t.paginacao.carregando&&t.paginacao.hasMore)try{t.paginacao.carregando=!0,r.loadingMore&&(r.loadingMore.style.display="flex"),await new Promise(o=>setTimeout(o,500)),t.paginacao.hasMore=!1,t.paginacao.paginaAtual++}catch(o){}finally{t.paginacao.carregando=!1,r.loadingMore&&(r.loadingMore.style.display="none")}},invalidarCache(){sessionStorage.removeItem("sriphone-produtos-cache"),sessionStorage.removeItem("sriphone-produtos-cache-time"),t.paginacao.paginaAtual=1,t.paginacao.hasMore=!0}};async function p(){const e=await o.getSession();document.querySelectorAll(".btn-editar-produto").forEach((o,a)=>{const t=o.closest(".produto-card"),r=t?.querySelector(".produto-info");t?(e?(o.classList.add("visible"),r&&r.classList.add("com-editar")):(o.classList.remove("visible"),r&&r.classList.remove("com-editar")),o.addEventListener("click",u)):o.remove()})}function u(o){o.stopPropagation(),o.preventDefault();const e=o.currentTarget.dataset.produtoEdit;if(e)try{const o=JSON.parse(e);window.abrirModalEditarProduto(o)}catch(a){m("Erro ao carregar dados do produto","error")}else m("Erro: dados do produto não encontrados","error")}function m(o,e="info"){const a=document.createElement("div");a.className=`toast toast-${e}`,a.textContent=o,document.body.appendChild(a),setTimeout(()=>a.classList.add("show"),10),setTimeout(()=>{a.classList.remove("show"),setTimeout(()=>a.remove(),300)},3e3)}window.abrirModalLogin=()=>{r.modalLogin?.classList.add("active")},function(){const e=localStorage.getItem("modoVisualizacao");t.modoVisualizacao=e||(window.innerWidth<768?"coluna":"grade"),r.searchInput?.addEventListener("input",l.searchInput),r.toggleFiltros?.addEventListener("click",l.toggleFiltros),r.filtroCondicao?.addEventListener("change",l.filtroCondicao),r.filtroBateria?.addEventListener("change",l.filtroBateria),r.filtroOrdenacao?.addEventListener("change",l.filtroOrdenacao),r.btnLimparFiltros?.addEventListener("click",l.limparFiltros),r.visualizacaoBtns.forEach(o=>{o.addEventListener("click",l.visualizacaoClick)}),r.formLogin?.addEventListener("submit",l.loginSubmit),r.modalLogin?.querySelector(".modal-close")?.addEventListener("click",l.closeModalLogin),r.modalLogin?.querySelector(".modal-overlay")?.addEventListener("click",l.closeModalLogin),window.addEventListener("produtos-updated",()=>{g.invalidarCache(),g.carregarDados()}),r.scrollSentinel&&new IntersectionObserver(o=>{o.forEach(o=>{o.isIntersecting&&!t.paginacao.carregando&&t.paginacao.hasMore&&g.carregarMaisProdutos()})},{root:null,rootMargin:"100px",threshold:.1}).observe(r.scrollSentinel),g.carregarDados(),o.onAuthStateChange(()=>{p()})}();const h=new IntersectionObserver(o=>{o.forEach(o=>{if(o.isIntersecting){const e=o.target;e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"),h.unobserve(e))}})},{root:null,rootMargin:"50px",threshold:.01});
