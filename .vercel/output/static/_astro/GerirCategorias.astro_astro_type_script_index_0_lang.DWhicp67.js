import{c as e}from"./supabase.Cm9Ta47n.js";const t=document.getElementById("modal-categorias"),n=t?.querySelector(".gc-modal-overlay"),o=t?.querySelector(".gc-modal-close"),i=document.getElementById("form-nova-categoria"),a=document.getElementById("nova-categoria-nome"),r=i?.querySelector(".gc-btn-add"),s=document.getElementById("categories-list"),c=document.getElementById("gc-loading"),d=i?.querySelector(".gc-error-message");let l=!1,p=[];function u(e,t="info"){const n=document.createElement("div");n.className=`gc-toast gc-toast-${t}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>n.classList.add("show"),10),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>n.remove(),300)},3e3)}function m(e){if(!e||e.length<2)return d.textContent="Mínimo de 2 caracteres",!1;if(e.length>50)return d.textContent="Máximo de 50 caracteres",!1;if(!/^[A-Za-zÀ-ÖØ-öø-ÿ0-9\s]+$/.test(e))return d.textContent="Use apenas letras, números e espaços",!1;return p.some(t=>t.nome.toLowerCase()===e.toLowerCase())?(d.textContent="Esta categoria já existe",!1):(d.textContent="",!0)}async function g(){if(s&&c&&!l)try{l=!0,c.classList.add("active"),s.innerHTML="";const t=await e.getAll()||[];if(p=function(e){const t={"iphone 4":1,"iphone 4s":2,"iphone 5":3,"iphone 5c":4,"iphone 5s":5,"iphone 6":6,"iphone 6 plus":7,"iphone 6s":8,"iphone 6s plus":9,"iphone 7":10,"iphone 7 plus":11,"iphone 8":12,"iphone 8 plus":13,"iphone x":14,"iphone xr":15,"iphone xs":16,"iphone xs max":17,"iphone 11":18,"iphone 11 pro":19,"iphone 11 pro max":20,"iphone se":21,"iphone se 2":22,"iphone se 3":23,"iphone 12":24,"iphone 12 mini":25,"iphone 12 pro":26,"iphone 12 pro max":27,"iphone 13":28,"iphone 13 mini":29,"iphone 13 pro":30,"iphone 13 pro max":31,"iphone 14":32,"iphone 14 plus":33,"iphone 14 pro":34,"iphone 14 pro max":35,"iphone 15":36,"iphone 15 plus":37,"iphone 15 pro":38,"iphone 15 pro max":39,"iphone 16":40,"iphone 16 plus":41,"iphone 16 pro":42,"iphone 16 pro max":43,"iphone 17":44,"iphone 17 air":45,"iphone 17 pro":46,"iphone 17 pro max":47};return[...e].sort((e,n)=>{const o=e.nome.toLowerCase().trim(),i=n.nome.toLowerCase().trim(),a=t[o],r=t[i];return void 0!==a&&void 0!==r?a-r:void 0!==a?-1:void 0!==r?1:o.localeCompare(i,"pt-BR")})}(t),0===p.length)return void(s.innerHTML='\n                <div class="gc-empty-state">\n                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M3 7H21M3 12H21M3 17H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n                    </svg>\n                    <p>Nenhuma categoria cadastrada</p>\n                    <small>Adicione sua primeira categoria acima</small>\n                </div>');const n=document.createDocumentFragment();p.forEach(e=>{const t=function(e){const t=document.createElement("div");t.classList.add("gc-category-item"),t.dataset.id=e.id;const n=document.createElement("span");n.classList.add("gc-category-name"),n.textContent=e.nome;const o=document.createElement("div");o.classList.add("gc-category-actions");const i=document.createElement("button");i.type="button",i.className="gc-btn-icon edit",i.setAttribute("aria-label","Editar categoria"),i.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>';const a=document.createElement("button");return a.type="button",a.className="gc-btn-icon delete",a.setAttribute("aria-label","Excluir categoria"),a.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>',o.append(i,a),t.append(n,o),i.addEventListener("click",()=>v(t,e)),a.addEventListener("click",()=>h(e.id)),t}(e);n.appendChild(t)}),s.appendChild(n)}catch(t){s.innerHTML='\n            <div class="gc-empty-state gc-error">\n                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n                </svg>\n                <p>Erro ao carregar categorias</p>\n                <button type="button" class="gc-btn-retry" onclick="window.location.reload()">\n                    Tentar novamente\n                </button>\n            </div>',u("Erro ao carregar categorias","error")}finally{l=!1,c.classList.remove("active")}}async function h(t){if(!confirm("Tem certeza que deseja excluir esta categoria?"))return;const n=s?.querySelector(`[data-id="${t}"]`);if(n)try{n.classList.add("gc-deleting"),await e.delete(t),p=p.filter(e=>e.id!==t),n.addEventListener("transitionend",()=>{n.remove(),0===p.length&&g()},{once:!0}),window.dispatchEvent(new Event("produtos-updated")),u("Categoria excluída com sucesso!","success")}catch(o){n.classList.remove("gc-deleting"),u("Erro ao excluir categoria. Tente novamente.","error")}}function v(t,n){const o=t.querySelector(".gc-category-name"),i=t.querySelector(".gc-category-actions");if(!o||!i)return;const a=t.innerHTML;o.innerHTML=`\n        <input type="text" \n            class="gc-category-input" \n            value="${n.nome}"\n            minlength="2"\n            maxlength="50"\n            pattern="[A-Za-zÀ-ÖØ-öø-ÿ0-9s]+"\n            required\n        />\n    `,i.innerHTML='\n        <button type="button" class="gc-btn-icon save" aria-label="Salvar">\n            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n        </button>\n        <button type="button" class="gc-btn-icon cancel" aria-label="Cancelar">\n            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n            </svg>\n        </button>\n    ';const r=o.querySelector("input"),s=i.querySelector(".save"),c=i.querySelector(".cancel");r&&(r.focus(),r.select());const d=async()=>{const o=r?.value.trim();if(o&&o!==n.nome)if(m(o))try{t.classList.add("gc-saving"),await e.update(n.id,o);const i=p.findIndex(e=>e.id===n.id);-1!==i&&(p[i].nome=o),window.dispatchEvent(new Event("produtos-updated")),g(),u("Categoria atualizada!","success")}catch(i){t.classList.remove("gc-saving"),t.innerHTML=a,u("Erro ao atualizar categoria. Tente novamente.","error")}else r?.focus();else l()},l=()=>{t.innerHTML=a;const e=t.querySelector(".edit"),o=t.querySelector(".delete");e?.addEventListener("click",()=>v(t,n)),o?.addEventListener("click",()=>h(n.id))};s?.addEventListener("click",d),c?.addEventListener("click",l),r?.addEventListener("keydown",e=>{"Enter"===e.key?(e.preventDefault(),d()):"Escape"===e.key&&l()})}function w(){if(!t||l)return;const e=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.top="",window.scrollTo(0,-1*parseInt(e||"0")),t.classList.remove("active"),a&&(a.value="",a.disabled=!1),r&&(r.disabled=!0),d&&(d.textContent="")}a?.addEventListener("input",e=>{const t=m(e.target.value.trim());r.disabled=!t}),i?.addEventListener("submit",async t=>{if(t.preventDefault(),!a||a.disabled)return;const n=a.value.trim();if(n&&m(n))try{a.disabled=!0,r.disabled=!0,i.classList.add("gc-submitting"),await e.create(n),a.value="",a.disabled=!1,r.disabled=!0,i.classList.remove("gc-submitting"),g(),window.dispatchEvent(new Event("produtos-updated")),u("Categoria criada com sucesso!","success")}catch(o){a.disabled=!1,r.disabled=!1,i.classList.remove("gc-submitting"),u("Erro ao criar categoria. Tente novamente.","error")}}),o?.addEventListener("click",w),n?.addEventListener("click",w),document.addEventListener("keydown",e=>{"Escape"===e.key&&t?.classList.contains("active")&&w()}),window.abrirGerirCategorias=function(){t&&(t.classList.add("active"),document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${window.scrollY}px`,window.innerWidth>=768&&setTimeout(()=>a?.focus(),300),g())};
