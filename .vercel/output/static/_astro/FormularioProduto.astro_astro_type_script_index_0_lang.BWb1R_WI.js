import{p as e,c as t}from"./supabase.Cm9Ta47n.js";const o=document.getElementById("modal-form-produto"),n=document.getElementById("form-produto"),r=document.getElementById("image-upload-area"),a=document.getElementById("product-images"),i=document.getElementById("image-preview-grid"),s=document.getElementById("upload-progress"),d=o?.querySelector(".btn-cancel"),c=o?.querySelector(".modal-close"),l=document.getElementById("produto-categoria"),m=n?.querySelector(".btn-submit");let u=[];function g(e){const t=document.getElementById("upload-placeholder");if(5-u.length<=0)return void v("Máximo de 5 imagens atingido","warning");let o=0;const n=[];Array.from(e).forEach(e=>{e.type.startsWith("image/")&&u.length+o<5&&(n.push(e),o++)}),u.push(...n),o>0&&(p(),u.length>=5&&v("Limite de 5 imagens atingido","info")),u.length>0&&t&&t.classList.add("hidden")}function p(){if(!i)return;const e=document.getElementById("upload-placeholder");i.innerHTML="",u.forEach((e,t)=>{!function(e,t){if(!i)return;const o=new FileReader;o.onload=e=>{const o=document.createElement("div");o.className="image-preview-item",o.innerHTML=`\n                <img src="${e.target?.result}" alt="Preview ${t+1}" loading="lazy">\n                <button type="button" class="remove-image" data-index="${t}" aria-label="Remover imagem">\n                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n                    </svg>\n                </button>\n                <span class="image-number">${t+1}</span>\n            `;const n=o.querySelector(".remove-image");n?.addEventListener("click",e=>{e.stopPropagation(),u.splice(t,1),p(),v("Imagem removida","info")}),i.appendChild(o)},o.readAsDataURL(e)}(e,t)}),u.length>0&&e?e.classList.add("hidden"):e&&e.classList.remove("hidden")}function v(e,t="info"){const o=document.createElement("div");o.className=`toast toast-${t}`,o.textContent=e,document.body.appendChild(o),setTimeout(()=>o.classList.add("show"),10),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>o.remove(),300)},3e3)}function y(){const e=document.getElementById("upload-placeholder");if(o?.classList.remove("active"),document.body.style.overflow="",n?.reset(),u=[],i&&(i.innerHTML=""),e&&e.classList.remove("hidden"),s){s.classList.remove("active");const e=s.querySelector(".progress-fill");e&&(e.style.width="0%")}}r?.addEventListener("click",()=>{u.length>=5?v("Máximo de 5 imagens permitido","warning"):a?.click()}),r?.addEventListener("dragover",e=>{e.preventDefault(),r.style.borderColor="#fff"}),r?.addEventListener("dragleave",()=>{r.style.borderColor="rgba(255, 255, 255, 0.1)"}),r?.addEventListener("drop",e=>{e.preventDefault(),r.style.borderColor="rgba(255, 255, 255, 0.1)";const t=e.dataTransfer?.files;t&&g(t)}),a?.addEventListener("change",e=>{const t=e.target,o=t.files;o&&g(o),t.value=""}),n?.addEventListener("submit",async t=>{if(t.preventDefault(),function(){if(0===u.length)return v("Adicione pelo menos uma imagem do produto","warning"),r?.scrollIntoView({behavior:"smooth",block:"center"}),!1;if(parseFloat(document.getElementById("produto-preco").value)<=0)return v("O preço deve ser maior que zero","warning"),!1;const e=parseInt(document.getElementById("produto-bateria").value);return!(e<0||e>100)||(v("A bateria deve estar entre 0 e 100%","warning"),!1)}())try{m&&(m.disabled=!0,m.querySelector(".btn-text").textContent="Criando...",m.querySelector(".btn-spinner").setAttribute("style","display: inline-block")),document.body.style.overflow="hidden";const t=s?.querySelector(".progress-fill");s?.classList.add("active");const o=[];for(let n=0;n<u.length;n++){const r=await e.uploadImage(u[n]);if(o.push(r),t){const e=(n+1)/u.length*100;t.style.width=`${e}%`}}s?.classList.remove("active");const r=new FormData(n),a={codigo:r.get("codigo"),nome:r.get("nome"),descricao:r.get("descricao"),preco:parseFloat(r.get("preco")),condicao:r.get("condicao"),bateria:parseInt(r.get("bateria")),categoria_id:r.get("categoria"),imagens:o};await e.create(a),window.dispatchEvent(new Event("produtos-updated")),y(),v("Produto criado com sucesso!","success")}catch(o){v(`Erro ao criar produto: ${o?.message||JSON.stringify(o)||"Erro desconhecido"}`,"error")}finally{m&&(m.disabled=!1,m.querySelector(".btn-text").textContent="Criar Produto",m.querySelector(".btn-spinner").setAttribute("style","display: none")),s?.classList.remove("active"),document.body.style.overflow=""}}),d?.addEventListener("click",y),c?.addEventListener("click",y),o?.querySelector(".modal-overlay")?.addEventListener("click",y),document.addEventListener("keydown",e=>{"Escape"===e.key&&o?.classList.contains("active")&&y()}),window.abrirFormProduto=function(){o?.classList.add("active"),document.body.style.overflow="hidden",async function(){if(l)try{const e=await t.getAll();l.innerHTML='<option value="">Selecione a categoria...</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.nome,l.appendChild(t)})}catch(e){v("Erro ao carregar categorias","error")}}(),window.innerWidth>=768&&setTimeout(()=>{document.getElementById("produto-nome")?.focus()},300)};
