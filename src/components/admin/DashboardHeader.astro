---
import { authService } from '../../lib/supabase';
import '../../styles/admin-header.css';
---

<header class="dashboard-header mobile-only">
  <div class="dashboard-header-left">
    <h1 class="dashboard-title">Dashboard</h1>
    <p class="dashboard-subtitle">Bem-vindo(a) ao painel administrativo</p>
  </div>

  <button
    type="button"
    id="logout-btn"
    class="logout-btn"
    aria-label="Sair da conta"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
      ></path>
    </svg>
    Sair
  </button>

  <script>
    import { authService } from '../../lib/supabase';

    const logoutBtn = document.getElementById('logout-btn');

    if (!logoutBtn) {
      console.error('[Logout] Bot√£o de logout n√£o encontrado!');
    } else {
      console.log('[Logout] Bot√£o de logout encontrado, adicionando listener');

      logoutBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        console.log('[Logout] Bot√£o clicado');

        if (confirm('Tem certeza que deseja sair?')) {
          console.log('[Logout] Usu√°rio confirmou logout');

          try {
            // 1. Limpar sess√£o do Supabase no cliente
            console.log('[Logout] Limpando sess√£o do Supabase...');
            await authService.signOut();
            console.log('[Logout] ‚úÖ Sess√£o do Supabase limpa');

            // 2. Limpar cookies no servidor
            console.log('[Logout] Chamando API de logout...');
            const response = await fetch('/api/admin/auth/logout', {
              method: 'POST',
              credentials: 'include',
            });

            if (response.ok) {
              console.log('[Logout] ‚úÖ Cookies limpos no servidor');
            } else {
              console.warn('[Logout] ‚ö†Ô∏è Falha ao limpar cookies, mas continuando...');
            }

            // 3. Redirecionar para login
            console.log('[Logout] üöÄ Redirecionando para /admin/login...');
            window.location.replace('/admin/login');
          } catch (error) {
            console.error('[Logout] ‚ùå Erro ao fazer logout:', error);
            // Mesmo com erro, redirecionar
            window.location.replace('/admin/login');
          }
        } else {
          console.log('[Logout] Usu√°rio cancelou logout');
        }
      });
    }
  </script>
</header>
