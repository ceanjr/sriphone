---
import Layout from './Layout.astro';
import Sidebar from '../components/admin/Sidebar.astro';
import MobileNav from '../components/admin/MobileNav.astro';
import Toast from '../components/admin/Toast.astro';
import '../styles/admin.css';

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'Painel administrativo Sr. IPHONE VCA' } =
  Astro.props;

// NOTA: A autentica√ß√£o √© verificada pelo middleware (src/middleware.ts)
// N√£o precisamos verificar novamente aqui para evitar dupla verifica√ß√£o
// que pode causar problemas de redirecionamento
console.log('[AdminLayout] Renderizando layout para:', Astro.url.pathname);
console.log('[AdminLayout] Usu√°rio autenticado via middleware:', !!Astro.locals.user);
---

<Layout title={title} description={description}>
  <div class="admin-layout">
    <!-- Sidebar Desktop -->
    <aside class="admin-sidebar">
      <Sidebar />
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
      <slot />
    </main>
    <!-- Mobile Navigation -->
  </div>
  <MobileNav />

  <!-- Toast Notifications -->
  <Toast />

  <!-- Script de diagn√≥stico inline -->
  <script is:inline>
    (function() {
      console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
      console.log('üîç [ADMIN LAYOUT] Script iniciado');
      console.log('üîç [ADMIN LAYOUT] URL:', window.location.href);
      console.log('üîç [ADMIN LAYOUT] Timestamp:', new Date().toISOString());
      console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');

      // Interceptar todos os clicks em links para debug
      document.addEventListener('click', function(e) {
        const target = e.target;
        const link = target.closest('a');

        if (link && link.href) {
          console.log('üîó [NAVIGATION] Link clicado:', link.href);
          console.log('üîó [NAVIGATION] Text:', link.textContent?.trim());
          console.log('üîó [NAVIGATION] Target:', link.target);
        }
      }, true);

      // Log quando a p√°gina est√° pronta para navegar
      window.addEventListener('load', () => {
        console.log('‚úÖ [ADMIN LAYOUT] P√°gina completamente carregada');
      });
    })();
  </script>
</Layout>
