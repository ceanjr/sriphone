---
export const prerender = false;

import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

import { productService, categoryService } from '../lib/supabase';

// Buscar dados
const produtosIniciais = await productService.getPaginated(undefined, 30);
const categorias = await categoryService.getAll();

console.log('ğŸ“Š Catalogo Simple:', {
  produtos: produtosIniciais.produtos?.length || 0,
  categorias: categorias?.length || 0,
});
---

<Layout title="CatÃ¡logo Simple" description="Teste">
  <Header />

  <main style="padding: 2rem; background: #000; color: #fff; min-height: 100vh;">
    <div style="max-width: 1200px; margin: 0 auto;">
      <h1 style="color: #0f0; margin-bottom: 2rem;">ğŸ§ª CATÃLOGO SIMPLIFICADO</h1>

      <div id="debug" style="background: #1a1a1a; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; font-family: monospace;">
        <p>Aguardando JavaScript...</p>
      </div>

      <div id="produtos-container" style="display: grid; gap: 1rem;">
        <!-- Produtos serÃ£o inseridos aqui -->
      </div>
    </div>
  </main>

  <Footer />

  <!-- Dados iniciais -->
  <script
    type="application/json"
    id="initial-data"
    set:html={JSON.stringify({
      produtos: produtosIniciais.produtos,
      categorias: categorias,
    })}
  />
</Layout>

<script>
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ” [SIMPLE] Script iniciado');

  // 1. Ler dados iniciais
  console.log('â³ [SIMPLE] Lendo dados iniciais...');
  const dataEl = document.getElementById('initial-data');
  const data = dataEl ? JSON.parse(dataEl.textContent || '{}') : {};
  console.log('âœ… [SIMPLE] Dados lidos:', {
    produtos: data.produtos?.length || 0,
    categorias: data.categorias?.length || 0,
  });

  // 2. Atualizar debug
  const debug = document.getElementById('debug');
  if (debug) {
    debug.innerHTML = `
      <p>âœ… Script executou!</p>
      <p>Produtos: ${data.produtos?.length || 0}</p>
      <p>Categorias: ${data.categorias?.length || 0}</p>
    `;
  }

  // 3. Renderizar produtos
  console.log('â³ [SIMPLE] Renderizando produtos...');
  const container = document.getElementById('produtos-container');

  if (container && data.produtos) {
    container.innerHTML = data.produtos.map((p: any) => `
      <div style="background: #1a1a1a; padding: 1rem; border-radius: 8px;">
        <h3>${p.nome}</h3>
        <p style="color: #888;">${p.descricao}</p>
        <p style="color: #0f0; font-weight: bold;">R$ ${p.preco}</p>
      </div>
    `).join('');

    console.log('âœ… [SIMPLE] Produtos renderizados!');
  }

  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('âœ… [SIMPLE] Script completo!');
</script>
