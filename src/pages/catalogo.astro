---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ModalProduto from '../components/ModalProduto.astro';
import EditarProduto from '../components/EditarProduto.astro';
import FormularioProduto from '../components/FormularioProduto.astro';
import GerirCategorias from '../components/GerirCategorias.astro';
import '../styles/pages/catalogo.css';

const metaDescription =
  'Explore nossa coleção exclusiva de iPhones novos e seminovos com garantia. Preços competitivos e qualidade certificada.';
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<Layout
  title="Catálogo | Sr. IPHONE"
  description="Explore nossa seleção exclusiva de iPhones seminovos com garantia e qualidade certificada."
>
  <fragment slot="head">
    <link rel="canonical" href={canonicalURL} />
    <meta property="og:title" content="Catálogo Exclusivo | Sr. IPHONE" />
    <meta property="og:description" content={metaDescription} />
    <meta property="og:image" content="/og-image.jpg" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
  </fragment>

  <Header />

  <nav class="breadcrumbs" aria-label="Breadcrumb">
    <ol>
      <li><a href="/">Início</a></li>
      <li><span aria-current="page">Catálogo</span></li>
    </ol>
  </nav>

  <main class="catalogo-page">
    <section class="hero-catalogo">
      <div class="container">
        <div class="hero-content">
          <picture>
            <source srcset="/images/Barbudo.webp" type="image/webp" />
            <img
              src="/images/Barbudo.webp"
              alt="Banner catálogo"
              loading="lazy"
            />
          </picture>
          <span class="eyebrow">NOSSA COLEÇÃO</span>
          <h1>Catálogo Exclusivo</h1>
          <p>
            iPhones novos e seminovos selecionados com garantia e qualidade
            certificada
          </p>
        </div>
      </div>
    </section>

    <section class="filtros-section">
      <div class="container">
        <!-- Busca -->
        <div class="search-bar">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"></path>
          </svg>
          <input
            type="text"
            id="search-input"
            placeholder="Buscar produtos..."
          />
        </div>

        <!-- Filtros -->
        <div class="filtros-container">
          <!-- Categorias (Destaque) -->
          <div class="categoria-filtros">
            <button
              class="categoria-btn active desktop-only"
              data-categoria="todos"
            >
              Todos
            </button>
            <div id="categorias-lista" class="desktop-only"></div>
            <select id="categoria-select" class="categoria-select mobile-only">
              <option value="todos">Todos</option>
              <!-- Categorias serão preenchidas via JavaScript -->
            </select>
          </div>

          <!-- Outros Filtros -->
          <button class="toggle-filtros" id="toggle-filtros">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M3 4H21M3 12H21M3 20H21"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"></path>
            </svg>
            Mais Filtros
          </button>

          <div class="filtros-avancados" id="filtros-avancados">
            <div class="filtro-group">
              <label>Condição</label>
              <select id="filtro-condicao">
                <option value="">Todas</option>
                <option value="Novo">Novo</option>
                <option value="Seminovo">Seminovo</option>
              </select>
            </div>

            <div class="filtro-group">
              <label>Bateria Mínima</label>
              <select id="filtro-bateria">
                <option value="0">Qualquer</option>
                <option value="80">80%+</option>
                <option value="90">90%+</option>
                <option value="95">95%+</option>
              </select>
            </div>

            <div class="filtro-group">
              <label>Ordenar Por</label>
              <select id="filtro-ordenacao">
                <option value="recente">Mais Recentes</option>
                <option value="preco-asc">Menor Preço</option>
                <option value="preco-desc">Maior Preço</option>
                <option value="bateria">Melhor Bateria</option>
              </select>
            </div>

            <button class="btn-limpar-filtros" id="btn-limpar-filtros">
              Limpar Filtros
            </button>
          </div>

          <!-- Controles de Visualização -->
          <div class="visualizacao-container">
            <span>Modos de Visualização</span>
            <div class="visualizacao-btns">
              <button
                class="visualizacao-btn active mobile-only"
                data-view="coluna"
                title="Exibição em coluna"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <rect
                    x="4"
                    y="4"
                    width="16"
                    height="4"
                    rx="1"
                    stroke="currentColor"
                    stroke-width="2"></rect>
                  <rect
                    x="4"
                    y="10"
                    width="16"
                    height="4"
                    rx="1"
                    stroke="currentColor"
                    stroke-width="2"></rect>
                  <rect
                    x="4"
                    y="16"
                    width="16"
                    height="4"
                    rx="1"
                    stroke="currentColor"
                    stroke-width="2"></rect>
                </svg>
              </button>
              <button
                class="visualizacao-btn"
                data-view="grade"
                title="Exibição em grade"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <rect
                    x="4"
                    y="4"
                    width="6"
                    height="6"
                    rx="1"
                    stroke="currentColor"
                    stroke-width="2"></rect>
                  <rect
                    x="14"
                    y="4"
                    width="6"
                    height="6"
                    rx="1"
                    stroke="currentColor"
                    stroke-width="2"></rect>
                  <rect
                    x="4"
                    y="14"
                    width="6"
                    height="6"
                    rx="1"
                    stroke="currentColor"
                    stroke-width="2"></rect>
                  <rect
                    x="14"
                    y="14"
                    width="6"
                    height="6"
                    rx="1"
                    stroke="currentColor"
                    stroke-width="2"></rect>
                </svg>
              </button>
              <button
                class="visualizacao-btn"
                data-view="lista"
                title="Exibição em lista"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <line
                    x1="4"
                    y1="6"
                    x2="20"
                    y2="6"
                    stroke="currentColor"
                    stroke-width="2"></line>
                  <line
                    x1="4"
                    y1="12"
                    x2="20"
                    y2="12"
                    stroke="currentColor"
                    stroke-width="2"></line>
                  <line
                    x1="4"
                    y1="18"
                    x2="20"
                    y2="18"
                    stroke="currentColor"
                    stroke-width="2"></line>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <section class="produtos-section">
        <div class="container">
          <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Carregando produtos...</p>
          </div>
          <div id="produtos-container"></div>
          <div id="empty-state" class="empty-state" style="display: none;">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M21 16V8C21 6.89543 20.1046 6 19 6H5C3.89543 6 3 6.89543 3 8V16C3 17.1046 3.89543 18 5 18H19C20.1046 18 21 17.1046 21 16Z"
                stroke="currentColor"
                stroke-width="2"></path>
            </svg>
            <p>Nenhum produto encontrado</p>
          </div>
        </div>
      </section>
    </section>

    <!-- Modal de Login -->
    <div id="modal-login" class="modal-login">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <button class="modal-close" aria-label="Fechar">×</button>
        <h2>Login Administrativo</h2>
        <form id="form-login">
          <div class="form-group">
            <label for="login-email">Email</label>
            <input type="email" id="login-email" required />
          </div>
          <div class="form-group">
            <label for="login-password">Senha</label>
            <input type="password" id="login-password" required />
          </div>
          <div id="login-error" class="error-message"></div>
          <button type="submit" class="btn-submit">Entrar</button>
        </form>
      </div>
    </div>

    <ModalProduto />
    <FormularioProduto />
    <GerirCategorias />
    <EditarProduto />
    <Footer />
  </main>

  <script type="module" src="/src/scripts/catalogo.ts" defer></script>
</Layout>
